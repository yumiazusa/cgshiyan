(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t(require("jquery")):typeof define==="function"&&define.amd?define(["jquery"],t):(e=e||self,e.DragSort=t(e.jQuery))})(this,function($){"use strict";function parseObj(e,t){if(e&&typeof e==="object"){return e}else if(e&&typeof e==="string"){try{return JSON.parse(e)}catch(e){console.error(e.message)}}else{return t||null}}function copyObj(e){return JSON.parse(JSON.stringify(typeof e==="undefined"?null:e))}function createRequest(){if(window.XMLHttpRequest){return new XMLHttpRequest}else if(window.ActiveXObject){let t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(let e=0;e<t.length;e++){try{return new ActiveXObject(t[e])}catch(e){}}}return null}function sortArr(e,t,a){a=a||"";let r=1;if(t&&t.toLowerCase()=="desc")r=-1;e.sort(function(e,t){let n,i;n=a?e[a]:e;i=a?t[a]:t;if(n>i){return 1*r}else if(n<i){return-1*r}else{return 0*r}});return e}function isHtmlEle(e){return typeof HTMLElement==="object"?e instanceof HTMLElement:e&&typeof e==="object"&&e.nodeType===1&&typeof e.nodeName==="string"}function getEle(e,t){e=isHtmlEle(e)?e:document;if(typeof t==="string"){return e.querySelector(t)}if(isHtmlEle(t)){return t}return null}function addEvent(e,t,n,i){i=typeof i==="string"&&i.toLowerCase()==="false"?false:Boolean(i);e.addEventListener?e.addEventListener(t,n,i):e.attachEvent?e.attachEvent("on"+t,n,i):e["on"+t]=n}function removeEvent(e,t,n,i){i=typeof i==="string"&&i.toLowerCase()==="false"?false:Boolean(i);e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent("on"+t,n,i)}function preventDefaultEvent(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;return false}function stopPropagationEvent(e){e=e||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=true}function elData(e,t,n){let i="_elData",a=typeof t,r=typeof n;t=a==="string"?t.trim():t;if(a!=="undefined"&&r!=="undefined"){if(t===null||a==="number"||a==="boolean"){return e}if(!(i in e)){e[i]={}}e[i][t]=n;return e}if(a==="undefined"&&r==="undefined"){return e[i]||{}}if(a!=="undefined"&&r==="undefined"){return i in e&&t in e[i]?e[i][t]:undefined}}function getEleIndex(e){let t=0;if(!e||!e.parentNode){return-1}while(e&&(e=e.previousElementSibling)){t++}return t}function addCss(e,t,n){let i=e&&e.style;if(i){if(n===void 0){if(document.defaultView&&document.defaultView.getComputedStyle){n=document.defaultView.getComputedStyle(e,"")}else if(e.currentStyle){n=e.currentStyle}return t===void 0?n:n[t]}else{if(!(t in i)){t="-webkit-"+t}i[t]=n+(typeof n==="string"?"":"px")}}}function DragSort(el,options){if(!(this instanceof DragSort)){return new DragSort(el,options)}this.drag=getEle(document,typeof $!=="undefined"&&el instanceof jQuery&&el.length>0?el[0]:el);this.options={idField:this.drag.getAttribute("idField")||"id",textField:this.drag.getAttribute("textField")||"name",iconField:this.drag.getAttribute("iconField")||"",sortName:this.drag.getAttribute("sortName")||"",sortOrder:this.drag.getAttribute("sortOrder")||"asc",itemHeight:this.drag.getAttribute("itemHeight")||"100",itemWidth:this.drag.getAttribute("itemWidth")||"120",showClose:this.drag.getAttribute("showClose")&&this.drag.getAttribute("showClose")=="false"?false:true,allowDrag:this.drag.getAttribute("allowDrag")&&this.drag.getAttribute("allowDrag")=="false"?false:true,url:this.drag.getAttribute("url")||"",ajaxType:this.drag.getAttribute("ajaxType")||"get",ajaxData:this.drag.getAttribute("ajaxData")||null,data:this.drag.getAttribute("data")||null,times:this.drag.getAttribute("times")||700,onitemclick:eval(this.drag.getAttribute("onitemclick"))||null,onitemremove:eval(this.drag.getAttribute("onitemremove"))||null,onitemdragstart:eval(this.drag.getAttribute("onitemdragstart"))||null,onitemdragover:eval(this.drag.getAttribute("onitemdragover"))||null,onitemdragend:eval(this.drag.getAttribute("onitemdragend"))||null,onrendered:eval(this.drag.getAttribute("onrendered"))||null};this.drag.classList.add("dragContainer");this.init(options)}DragSort.prototype={constructor:DragSort,init:function(options){this.options=Object.assign(this.options,{data:null},options||{});let opts=this.options,_this=this,drag=this.drag;setOpts();render();function setOpts(){opts.ajaxData=parseObj(opts.ajaxData);opts.data=parseObj(opts.data);if(!opts.data){urlGetData()}opts.data=sortArr(opts.data,opts.sortOrder,opts.sortName);elData(drag,"list",opts.data);for(let e in opts){drag.removeAttribute(e)}}function urlGetData(){let n=_this.options.url,t=_this.options.ajaxType,i=_this.options.ajaxData;if(n){let e=createRequest();e.onreadystatechange=function(){if(e.readyState===4&&e.status===200){_this.options.data=typeof e.responseText==="string"?JSON.parse(e.responseText):e.responseText}};if(t&&t.toLowerCase()==="post"){e.open("post",n,false);e.setRequestHeader("Content-type","application/json;charset=utf-8");e.send(JSON.stringify(i))}else{if(i){let t="";for(let e in i){t+="&"+e+"="+i[e]}n+=n.indexOf("?")!==-1?t:t.replace("&","?")}e.open("get",n,false);e.send(null)}}else{_this.options.data=[]}}function render(){drag.innerHTML="";let data=_this.options.data,scopeSelector="";if(drag.id){scopeSelector=`#${drag.id}`}else{drag.classList.forEach(function(e){scopeSelector+="."+e})}let style=document.querySelector("style#dragStyle");if(!style){style=document.createElement("style");style.setAttribute("id","dragStyle");style.innerHTML=`.dragContainer,.dragArea {  width: 100%;height:100%;box-sizing: border-box;  }
                                .dragItem { display: block; position: relative; float: left; border: 1px solid #CCC;color: #fff; margin: 6px;border-radius: 4px;box-sizing: border-box;padding: 14px 6px 6px 6px;overflow:hidden;box-shadow: 0 0 4px 2px rgb(0 0 0 / 10%);background: #4cb0c1; }
                                .dragItem:hover{background: #40c1d7;cursor: pointer;}
                                .dragItem:active{background:#168fa3;cursor: default;}
                                .itemRemove {position: absolute;right: 0;top: 0;width: 16px;height: 16px;z-index: 1;text-align: center;line-height: 12px;font-family: cursive;cursor: default;font-size: 14px;}
                                .itemRemove:hover{color:#f76d6d;}
                                .itemRemove:active{color:#ff0000;}
                                .itemContent{text-align: center;font-family: '微软雅黑';height: 100%;overflow: hidden;}
                                .itemContent>span{font-weight:bold;display:block;padding-top:4px;}
                                .itemContent>i {display:block;font-size:36px; }`;document.querySelector("head").appendChild(style)}style.innerHTML+=`${scopeSelector} .dragItem{width: ${opts.itemWidth||100}px; height:  ${opts.itemHeight||100}px;}`;if(opts.iconField){style.innerHTML+=`${scopeSelector} .itemContent>i{height:36px;}`}for(let i=0;i<data.length;i++){data[i]._index=i;_this.addItem(data[i],i)}opts.onrendered&&eval(opts.onrendered)&&eval(opts.onrendered)(_this)}return this},addItem:function(obj,index){let data=elData(this.drag,"list"),_self=this,opts=this.options,dragEl=this.drag.querySelector(".dragItem#item_"+obj[opts.idField]);if(index==undefined)index=data.length||opts.data.length;obj._index=index+1;if(!data.some(e=>e[opts.idField]==obj[opts.idField])){data.push(obj);opts.data=data;elData(this.drag,"list",opts.data)}if(dragEl){elData(dragEl,"sender",obj);return this}dragEl=document.createElement("div");elData(dragEl,"sender",obj);let iconClass=opts.iconField?obj[opts.iconField]?obj[opts.iconField]:"noicon":"",contentEl=document.createElement("div"),i=document.createElement("i"),txt=document.createElement("span");dragEl.setAttribute("class","dragItem");dragEl.setAttribute("id",`item_${typeof obj[opts.idField]==="string"?obj[opts.idField].trim():obj[opts.idField]}`);txt.innerHTML=obj[opts.textField];iconClass&&i.setAttribute("class",iconClass);contentEl.setAttribute("class","itemContent");contentEl.appendChild(i);contentEl.appendChild(txt);dragEl.appendChild(contentEl);if(opts.allowDrag){dragEl.setAttribute("draggable",true);addEvent(dragEl,"dragstart",dragstartFn,false);addEvent(dragEl,"dragover",dragoverFn,false);addEvent(dragEl,"dragend",dragendFn,false)}this.drag.appendChild(dragEl);addEvent(dragEl,"click",clickFn,false);addEvent(txt,"mouseenter",mouseenterFn,false);addEvent(txt,"mouseleave",mouseleaveFn,false);if(opts.showClose){let del=document.createElement("div");del.setAttribute("class","itemRemove");del.innerHTML="x";dragEl.appendChild(del);addEvent(del,"click",removeFn,false)}function clickFn(e){opts.data=elData(_self.drag,"list");opts.onitemclick&&eval(opts.onitemclick)(copyObj(elData(this,"sender")),_self,this,e);preventDefaultEvent(e);stopPropagationEvent(e)}function dragstartFn(e){opts.draging=e.target;opts.data=elData(_self.drag,"list");opts.onitemdragstart&&eval(opts.onitemdragstart)(copyObj(elData(this,"sender")),_self,this,e)}function dragoverFn(e){let target=e.target;if(!target.classList.contains("dragItem")){target=target.parentNode}else{if(target&&target.animated){return}let targetIndex=getEleIndex(target),dragingIndex=getEleIndex(opts.draging),nextNode="",animateObj=[];if(targetIndex!=dragingIndex){let preIndex="",nextIndex="",existingnode="";if(targetIndex>dragingIndex){preIndex=getEleIndex(opts.draging);nextIndex=getEleIndex(target);existingnode=target.nextElementSibling}else{preIndex=getEleIndex(target);nextIndex=getEleIndex(opts.draging);existingnode=target}for(let i=0;i<nextIndex-preIndex+1;i++){nextNode=!nextNode?opts.draging:targetIndex>dragingIndex?nextNode.nextElementSibling:nextNode.previousElementSibling;animateObj.push([nextNode.getBoundingClientRect(),nextNode])}target.parentNode.insertBefore(opts.draging,existingnode);for(let i=0;i<animateObj.length;i++){animate(animateObj[i][0],animateObj[i][1])}updateSort()}}opts.data=elData(_self.drag,"list");opts.onitemdragover&&eval(opts.onitemdragover)(copyObj(elData(this,"sender")),_self,this,e);preventDefaultEvent(e)}function dragendFn(e){opts.data=elData(_self.drag,"list");if("draging"in opts)delete opts["draging"];opts.onitemdragend&&eval(opts.onitemdragend)(copyObj(elData(this,"sender")),_self,this,e);preventDefaultEvent(e)}function mouseenterFn(e){this.setAttribute("title",this.innerText);preventDefaultEvent(e);stopPropagationEvent(e)}function mouseleaveFn(e){this.removeAttribute("title");preventDefaultEvent(e);stopPropagationEvent(e)}function removeFn(e){let item=elData(this.parentNode,"sender");_self.removeItem(item[opts.idField]);opts.data=elData(_self.drag,"list");opts.onitemremove&&eval(opts.onitemremove)(item,_self,this,e);preventDefaultEvent(e);stopPropagationEvent(e)}function animate(t,n){let i=opts.times;if(i){let e=n.getBoundingClientRect();if(t.nodeType===1){t=t.getBoundingClientRect()}addCss(n,"transition","none");addCss(n,"transform","translate3d("+(t.left-e.left)+"px,"+(t.top-e.top)+"px,0)");n.offsetWidth;addCss(n,"transition","all "+i+"ms");addCss(n,"transform","translate3d(0,0,0)");clearTimeout(n.animated);n.animated=setTimeout(function(){addCss(n,"transition","");addCss(n,"transform","");n.animated=false},i)}}function updateSort(){let n=[],i=_self.drag.querySelectorAll(".dragItem");for(let t=0;t<i.length;t++){let e=elData(i[t],"sender");e._index=t+1;elData(i[t],"sender");n.push(e)}opts.data=n;elData(_self.drag,"list",opts.data)}return this},getData:function(){return copyObj(elData(this.drag,"list"))},getItem:function(e){let t=this.drag.querySelector(".dragItem#item_"+e);return copyObj(t?elData(t,"sender"):null)},removeItem:function(e){let t=this.drag.querySelector(".dragItem#item_"+e),n=[];if(t)t.remove();let i=this.drag.querySelectorAll(".dragItem");for(let t=0;t<i.length;t++){let e=elData(i[t],"sender");e._index=t+1;elData(i[t],"sender",e);n.push(e)}this.options.data=n;elData(this.drag,"list",this.options.data);return this}};if(typeof $!=="undefined"){$.fn.dragSort=function(){let e=this.removeData("dragSort"),t=$.extend(true,{},$.fn.dragSort.data,arguments[0]);e=new DragSort(this,t);this.data("dragSort",e);return $.extend(true,this,e)};$.fn.dragSort.constructor=DragSort}return DragSort});